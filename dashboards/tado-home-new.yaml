# Tado Smart Home Dashboard Configuration
# Properly structured YAML without duplicate keys

title: Tado Smart Home
theme: tado_theme
icon: mdi:home-thermometer
background: center / cover no-repeat url("/local/house-background.jpg") fixed
path: tado-home

views:
  - title: Home
    path: home
    icon: mdi:home
    cards:
      # Header Section
      - type: vertical-stack
        cards:
          # Main header card
          - type: custom:button-card
            name: "Smart Home Climate Control"
            icon: mdi:home-thermometer-outline
            styles:
              card:
                - height: 80px
                - background: "linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)"
                - color: white
                - border-radius: 15px
                - box-shadow: "0 4px 8px rgba(255, 105, 0, 0.3)"
              name:
                - font-size: 24px
                - font-weight: bold
              icon:
                - font-size: 32px
            tap_action:
              action: none

          # Quick preset buttons
          - type: horizontal-stack
            cards:
              - type: custom:button-card
                name: Comfort
                icon: mdi:home-heart
                color: rgb(255, 105, 0)
                styles:
                  card:
                    - height: 60px
                    - border-radius: 10px
                  name:
                    - font-size: 14px
                    - font-weight: bold
                tap_action:
                  action: call-service
                  service: script.tado_comfort_mode
                
              - type: custom:button-card
                name: Eco
                icon: mdi:leaf
                color: rgb(76, 175, 80)
                styles:
                  card:
                    - height: 60px
                    - border-radius: 10px
                  name:
                    - font-size: 14px
                    - font-weight: bold
                tap_action:
                  action: call-service
                  service: script.tado_eco_mode
                
              - type: custom:button-card
                name: Party
                icon: mdi:party-popper
                color: rgb(156, 39, 176)
                styles:
                  card:
                    - height: 60px
                    - border-radius: 10px
                  name:
                    - font-size: 14px
                    - font-weight: bold
                tap_action:
                  action: call-service
                  service: script.tado_party_mode
                
              - type: custom:button-card
                name: Sleep
                icon: mdi:sleep
                color: rgb(63, 81, 181)
                styles:
                  card:
                    - height: 60px
                    - border-radius: 10px
                  name:
                    - font-size: 14px
                    - font-weight: bold
                tap_action:
                  action: call-service
                  service: script.tado_sleep_mode

      # Configuration Section
      - type: horizontal-stack
        cards:
          # House configuration panel
          - type: entities
            title: House Configuration
            icon: mdi:home-edit
            show_header_toggle: false
            entities:
              - entity: input_select.tado_room_layout_preset
                name: Layout Preset
              - type: divider
              - entity: input_number.tado_number_of_bedrooms
                name: Number of Bedrooms
              - entity: input_boolean.tado_has_garage
                name: Include Garage
              - entity: input_boolean.tado_has_loft
                name: Include Loft
              - type: divider
              - entity: sensor.room_configuration_summary
                name: Layout Type
              - entity: sensor.active_rooms_configuration
                name: Current Layout

          # Mini house layout preview
          - type: picture-elements
            image: /local/room-layout-mini.svg
            elements:
              - type: state-label
                entity: sensor.active_rooms_configuration
                style:
                  top: 95%
                  left: 50%
                  font-size: 12px
                  color: rgb(255, 105, 0)
                  font-weight: bold

      # Main thermostat controls
      - type: horizontal-stack
        cards:
          # Living Room thermostat
          - type: custom:button-card
            entity: climate.living_room_thermostat
            name: "[[[ return entity.attributes.friendly_name || 'Living Room' ]]]"
            icon: mdi:thermostat
            show_state: true
            show_name: true
            styles:
              card:
                - height: 120px
                - background: |
                    [[[
                      if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                      if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                      return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                    ]]]
                - color: white
                - border-radius: 15px
                - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
              name:
                - font-size: 16px
                - font-weight: bold
                - margin-bottom: 5px
              state:
                - font-size: 24px
                - font-weight: bold
              icon:
                - font-size: 32px
                - margin-bottom: 10px
            custom_fields:
              temperature: |
                [[[
                  const temp = entity.attributes.current_temperature;
                  const target = entity.attributes.temperature;
                  return `<div style="font-size: 14px; margin-top: 5px;">
                    Current: ${temp}°C<br>
                    Target: ${target}°C
                  </div>`;
                ]]]
            tap_action:
              action: more-info

          # Kitchen thermostat  
          - type: custom:button-card
            entity: climate.kitchen_thermostat
            name: "[[[ return entity.attributes.friendly_name || 'Kitchen' ]]]"
            icon: mdi:thermostat
            show_state: true
            show_name: true
            styles:
              card:
                - height: 120px
                - background: |
                    [[[
                      if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                      if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                      return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                    ]]]
                - color: white
                - border-radius: 15px
                - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
              name:
                - font-size: 16px
                - font-weight: bold
                - margin-bottom: 5px
              state:
                - font-size: 24px
                - font-weight: bold
              icon:
                - font-size: 32px
                - margin-bottom: 10px
            custom_fields:
              temperature: |
                [[[
                  const temp = entity.attributes.current_temperature;
                  const target = entity.attributes.temperature;
                  return `<div style="font-size: 14px; margin-top: 5px;">
                    Current: ${temp}°C<br>
                    Target: ${target}°C
                  </div>`;
                ]]]
            tap_action:
              action: more-info

      # Bedroom thermostats (dynamic based on configuration)
      - type: conditional
        conditions:
          - entity: input_number.tado_number_of_bedrooms
            state_not: "0"
        card:
          type: vertical-stack
          cards:
            - type: markdown
              content: "## Bedrooms"
              
            - type: horizontal-stack
              cards:
                # Bedroom 1
                - type: conditional
                  conditions:
                    - entity: input_number.tado_number_of_bedrooms
                      state_not: "0"
                  card:
                    type: custom:button-card
                    entity: climate.bedroom_1_thermostat
                    name: "[[[ return entity.attributes.friendly_name || 'Bedroom 1' ]]]"
                    icon: mdi:bed
                    show_state: true
                    show_name: true
                    styles:
                      card:
                        - height: 120px
                        - background: |
                            [[[
                              if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                              if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                              return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                            ]]]
                        - color: white
                        - border-radius: 15px
                        - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
                      name:
                        - font-size: 16px
                        - font-weight: bold
                        - margin-bottom: 5px
                      state:
                        - font-size: 24px
                        - font-weight: bold
                      icon:
                        - font-size: 32px
                        - margin-bottom: 10px
                    custom_fields:
                      temperature: |
                        [[[
                          const temp = entity.attributes.current_temperature;
                          const target = entity.attributes.temperature;
                          return `<div style="font-size: 14px; margin-top: 5px;">
                            Current: ${temp}°C<br>
                            Target: ${target}°C
                          </div>`;
                        ]]]
                    tap_action:
                      action: more-info

                # Bedroom 2
                - type: conditional
                  conditions:
                    - entity: sensor.tado_active_bedrooms
                      state_not: "1"
                  card:
                    type: custom:button-card
                    entity: climate.bedroom_2_thermostat
                    name: "[[[ return entity.attributes.friendly_name || 'Bedroom 2' ]]]"
                    icon: mdi:bed
                    show_state: true
                    show_name: true
                    styles:
                      card:
                        - height: 120px
                        - background: |
                            [[[
                              if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                              if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                              return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                            ]]]
                        - color: white
                        - border-radius: 15px
                        - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
                      name:
                        - font-size: 16px
                        - font-weight: bold
                        - margin-bottom: 5px
                      state:
                        - font-size: 24px
                        - font-weight: bold
                      icon:
                        - font-size: 32px
                        - margin-bottom: 10px
                    custom_fields:
                      temperature: |
                        [[[
                          const temp = entity.attributes.current_temperature;
                          const target = entity.attributes.temperature;
                          return `<div style="font-size: 14px; margin-top: 5px;">
                            Current: ${temp}°C<br>
                            Target: ${target}°C
                          </div>`;
                        ]]]
                    tap_action:
                      action: more-info

            - type: conditional
              conditions:
                - entity: sensor.tado_active_bedrooms
                  state: "3"
              card:
                type: horizontal-stack
                cards:
                  # Bedroom 3
                  - type: custom:button-card
                    entity: climate.bedroom_3_thermostat
                    name: "[[[ return entity.attributes.friendly_name || 'Bedroom 3' ]]]"
                    icon: mdi:bed
                    show_state: true
                    show_name: true
                    styles:
                      card:
                        - height: 120px
                        - background: |
                            [[[
                              if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                              if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                              return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                            ]]]
                        - color: white
                        - border-radius: 15px
                        - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
                      name:
                        - font-size: 16px
                        - font-weight: bold
                        - margin-bottom: 5px
                      state:
                        - font-size: 24px
                        - font-weight: bold
                      icon:
                        - font-size: 32px
                        - margin-bottom: 10px
                    custom_fields:
                      temperature: |
                        [[[
                          const temp = entity.attributes.current_temperature;
                          const target = entity.attributes.temperature;
                          return `<div style="font-size: 14px; margin-top: 5px;">
                            Current: ${temp}°C<br>
                            Target: ${target}°C
                          </div>`;
                        ]]]
                    tap_action:
                      action: more-info

      # Optional rooms (garage, loft)
      - type: horizontal-stack
        cards:
          # Garage
          - type: conditional
            conditions:
              - entity: input_boolean.tado_has_garage
                state: "on"
            card:
              type: custom:button-card
              entity: climate.garage_thermostat
              name: "[[[ return entity.attributes.friendly_name || 'Garage' ]]]"
              icon: mdi:garage
              show_state: true
              show_name: true
              styles:
                card:
                  - height: 120px
                  - background: |
                      [[[
                        if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                        if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                        return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                      ]]]
                  - color: white
                  - border-radius: 15px
                  - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
                name:
                  - font-size: 16px
                  - font-weight: bold
                  - margin-bottom: 5px
                state:
                  - font-size: 24px
                  - font-weight: bold
                icon:
                  - font-size: 32px
                  - margin-bottom: 10px
              custom_fields:
                temperature: |
                  [[[
                    const temp = entity.attributes.current_temperature;
                    const target = entity.attributes.temperature;
                    return `<div style="font-size: 14px; margin-top: 5px;">
                      Current: ${temp}°C<br>
                      Target: ${target}°C
                    </div>`;
                  ]]]
              tap_action:
                action: more-info

          # Loft
          - type: conditional
            conditions:
              - entity: input_boolean.tado_has_loft
                state: "on"
            card:
              type: custom:button-card
              entity: climate.loft_thermostat
              name: "[[[ return entity.attributes.friendly_name || 'Loft' ]]]"
              icon: mdi:stairs-up
              show_state: true
              show_name: true
              styles:
                card:
                  - height: 120px
                  - background: |
                      [[[
                        if (entity.state === 'heat') return 'linear-gradient(135deg, #FF6900 0%, #FF8A50 100%)';
                        if (entity.state === 'off') return 'linear-gradient(135deg, #607D8B 0%, #90A4AE 100%)';
                        return 'linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)';
                      ]]]
                  - color: white
                  - border-radius: 15px
                  - box-shadow: "0 4px 8px rgba(0, 0, 0, 0.2)"
                name:
                  - font-size: 16px
                  - font-weight: bold
                  - margin-bottom: 5px
                state:
                  - font-size: 24px
                  - font-weight: bold
                icon:
                  - font-size: 32px
                  - margin-bottom: 10px
              custom_fields:
                temperature: |
                  [[[
                    const temp = entity.attributes.current_temperature;
                    const target = entity.attributes.temperature;
                    return `<div style="font-size: 14px; margin-top: 5px;">
                      Current: ${temp}°C<br>
                      Target: ${target}°C
                    </div>`;
                  ]]]
              tap_action:
                action: more-info

      # House layout visualization
      - type: picture-elements
        image: /local/house-layout-dynamic.svg
        title: House Layout
        elements:
          # Living room thermostat indicator
          - type: state-badge
            entity: climate.living_room_thermostat
            style:
              top: 60%
              left: 25%
              transform: scale(0.8)
          
          # Kitchen thermostat indicator
          - type: state-badge
            entity: climate.kitchen_thermostat
            style:
              top: 30%
              left: 75%
              transform: scale(0.8)
          
          # Bedroom 1 thermostat indicator
          - type: conditional
            conditions:
              - entity: input_number.tado_number_of_bedrooms
                state_not: "0"
            elements:
              - type: state-badge
                entity: climate.bedroom_1_thermostat
                style:
                  top: 20%
                  left: 25%
                  transform: scale(0.8)

      # System status and information
      - type: entities
        title: System Status
        icon: mdi:information-outline
        show_header_toggle: false
        entities:
          - entity: sensor.tado_system_status
            name: System Status
          - entity: sensor.tado_connectivity_status
            name: Connectivity
          - entity: sensor.tado_average_temperature
            name: Average Temperature
          - entity: sensor.tado_energy_savings_today
            name: Energy Savings Today
          - type: divider
          - entity: binary_sensor.tado_presence_detected
            name: Presence Detected
          - entity: sensor.tado_outdoor_temperature
            name: Outdoor Temperature
          - entity: sensor.tado_weather_condition
            name: Weather Condition

  # Settings view
  - title: Settings
    path: settings
    icon: mdi:cog
    cards:
      - type: entities
        title: Tado Settings
        entities:
          - entity: input_number.tado_comfort_temperature
            name: Comfort Temperature
          - entity: input_number.tado_eco_temperature
            name: Eco Temperature
          - entity: input_number.tado_sleep_temperature
            name: Sleep Temperature
          - type: divider
          - entity: input_boolean.tado_geofencing_enabled
            name: Geofencing
          - entity: input_boolean.tado_window_detection_enabled
            name: Window Detection
          - entity: input_boolean.tado_adaptive_scheduling
            name: Adaptive Scheduling

      - type: entities
        title: Automation Controls
        entities:
          - entity: automation.tado_presence_based_heating
            name: Presence Based Heating
          - entity: automation.tado_window_open_detection
            name: Window Open Detection
          - entity: automation.tado_night_mode_scheduler
            name: Night Mode Scheduler
          - entity: automation.tado_energy_saving_optimizer
            name: Energy Saving Optimizer

  # Energy view
  - title: Energy
    path: energy
    icon: mdi:lightning-bolt
    cards:
      - type: energy-usage-graph
        title: Heating Energy Usage
        
      - type: statistics-graph
        title: Temperature Trends
        stat_types:
          - mean
        entities:
          - sensor.tado_average_temperature
          - sensor.tado_outdoor_temperature
        days_to_show: 7
        
      - type: entities
        title: Energy Statistics
        entities:
          - entity: sensor.tado_energy_consumption_today
            name: Energy Today
          - entity: sensor.tado_energy_consumption_week
            name: Energy This Week
          - entity: sensor.tado_energy_consumption_month
            name: Energy This Month
          - entity: sensor.tado_energy_savings_today
            name: Savings Today
          - entity: sensor.tado_energy_cost_today
            name: Cost Today
